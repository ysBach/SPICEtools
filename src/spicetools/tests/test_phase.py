import numpy as np
import pytest

from spicetools import phase


@pytest.mark.parametrize(
    ('alpha__deg', 'gpar', 'expected'),
    [
        (0, 0.00, 1.000000),
        (10, 0.00, 0.484177),
        (20, 0.00, 0.327015),
        (30, 0.00, 0.234145),
        (40, 0.00, 0.171887),
        (50, 0.00, 0.127593),
        (60, 0.00, 0.094800),
        (70, 0.00, 0.069879),
        (80, 0.00, 0.050648),
        (90, 0.00, 0.035722),
        (100, 0.00, 0.024185),
        (110, 0.00, 0.015418),
        (120, 0.00, 0.008984),
        (130, 0.00, 0.004552),
        (140, 0.00, 0.001827),
        (150, 0.00, 0.000477),
        (160, 0.00, 0.000047),
        (170, 0.00, 0.000000),
        (0, 0.15, 1.000000),
        (10, 0.15, 0.545283),
        (20, 0.15, 0.398067),
        (30, 0.15, 0.302204),
        (40, 0.15, 0.233194),
        (50, 0.15, 0.180363),
        (60, 0.15, 0.138377),
        (70, 0.15, 0.104291),
        (80, 0.15, 0.076394),
        (90, 0.15, 0.053668),
        (100, 0.15, 0.035513),
        (110, 0.15, 0.021576),
        (120, 0.15, 0.011592),
        (130, 0.15, 0.005212),
        (140, 0.15, 0.001808),
        (150, 0.15, 0.000419),
        (160, 0.15, 0.000040),
        (170, 0.15, 0.000000),
        (0, 0.50, 1.000000),
        (10, 0.50, 0.687862),
        (20, 0.50, 0.563855),
        (30, 0.50, 0.461006),
        (40, 0.50, 0.376243),
        (50, 0.50, 0.303494),
        (60, 0.50, 0.240056),
        (70, 0.50, 0.184586),
        (80, 0.50, 0.136468),
        (90, 0.50, 0.095542),
        (100, 0.50, 0.061944),
        (110, 0.50, 0.035944),
        (120, 0.50, 0.017679),
        (130, 0.50, 0.006753),
        (140, 0.50, 0.001764),
        (150, 0.50, 0.000286),
        (160, 0.50, 0.000024),
        (170, 0.50, 0.000000)
    ]
)
def test_iau_hg_model(alpha__deg, gpar, expected):
    result = phase.iau_hg_model(alpha__deg, gpar)
    assert np.isclose(result, expected, rtol=1e-6, atol=1e-6)

    # negative alpha (sometimes researchers define the negative phase angle
    # when the object is viewed in the evening side; positive phase angle is
    # when viewed in the morning side)
    result_neg = phase.iau_hg_model(-alpha__deg, gpar)
    assert np.isclose(result_neg, expected, rtol=1e-6, atol=1e-6)
